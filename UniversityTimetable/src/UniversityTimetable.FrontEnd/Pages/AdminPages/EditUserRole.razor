@page "/users/edit/{Id:int}"
@inherits EditPageBase<UserDto>

@if (Model is null)
{
    <p>
        <em>Loading...</em>
    </p>
    return;
}

<div class="col-md-3">
    <label class="form-label">Username @Model.Username</label>
</div>
<div class="col-md-3">
    <label class="form-label">Email @Model.Email</label>
</div>
<EditForm class="form-select" Model="Model" OnValidSubmit="@(() => Save(Model))">
    <InputSelect TValue="UserRole" Value="Model.Role" ValueExpression="@(() => Model.Role)" ValueChanged="RoleChanged">
        @foreach (var role in Enum.GetValues<UserRole>())
        {
            <option value="@role">@role</option>
        }
    </InputSelect>
    @if (Model.Role is UserRole.Admin or UserRole.Guest)
    {
        <button class="btn btn-success" type="submit">Save</button>
        return;
    }
    @if (Model.Role == UserRole.Teacher)
    {
        <SingleItemSelect TData="TeacherDto" TParameters="TeacherParameters"
                          SelectedId="Model.TeacherId"
                          SelectChanged="@(teacher => Model.Teacher = teacher)"/>
        <button class="btn btn-success" type="submit">Save</button>
        return;
    }
    @if (Model.Role == UserRole.Student)
    {
        <SingleItemSelect TData="StudentDto" TParameters="StudentParameters"
                          SelectedId="Model.StudentId" SelectChanged="@(student => Model.Student = student)"/>
        <button class="btn btn-success" type="submit">Save</button>
        return; 
    }
</EditForm>